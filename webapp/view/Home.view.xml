<mvc:View
    controllerName="com.zeim.fatturazioneattiva.controller.Home"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:f="sap.f"
    xmlns:card="sap.f.cards"
    xmlns:form="sap.ui.layout.form"
    xmlns:fb="sap.ui.comp.filterbar"
    xmlns:vh="sap.ui.comp.valuehelpdialog"
>
    <Page
        id="page"
        title="{i18n>title}"
    >
        <Panel>
            <FlexBox
                alignItems="Start"
                justifyContent="Center"
            >
                <SegmentedButton
                    id="idSegmentedBtn"
                    selectionChange=".onSegmentChange"
                    selectedKey="sd"
                >
                    <items>
                        <SegmentedButtonItem
                            key="sd"
                            text="Flusso Fatture SD"
                            width="auto"
                        />
                        <SegmentedButtonItem
                            key="fi"
                            text="Flusso Fatture FI"
                            width="auto"
                        />
                    </items>
                </SegmentedButton>
            </FlexBox>
        </Panel>

        <Panel headerText="Filtri di ricerca">
            <fb:FilterBar
                id="filterBar"
                persistencyKey="myPersKey"
                useToolbar="false"
                search=".onFilterBarSearch"
                showGoOnFB="true"
                isRunningInValueHelpDialog="false"
            >
                <fb:filterGroupItems>
                    <fb:FilterGroupItem
                        name="Customer"
                        label="Cliente"
                        groupName="Cliente"
                        visibleInFilterBar="true"
                    >
                        <fb:control>
                            <MultiInput
                                id="multiInput"
                                width="300px"
                                showValueHelp="true"
                                valueHelpRequest=".onValueHelpClienti"
                                showSuggestion="true"
                                suggestionItems="{path: 'Clienti>/I_Customer_VH'}"
                                data-model="Clienti"
                                data-key="Customer"
                                data-desc="OrganizationBPName1"
                            >
                                <suggestionItems>
                                    <core:Item
                                        key="{Clienti>Customer}"
                                        text="{Clienti>OrganizationBPName1}"
                                    />
                                </suggestionItems>
                            </MultiInput>
                        </fb:control>
                    </fb:FilterGroupItem>
                    <fb:FilterGroupItem
                        name="Paese dell'Esec.Pag."
                        label="Paese dell'Esec.Pag."
                        groupName="General"
                        visibleInFilterBar="true"
                    >
                        <fb:control>
                            <MultiInput
                                id="multiInputPaeseEsecutore"
                                width="300px"
                                showValueHelp="true"
                                valueHelpRequest=".onValueHelpPaeseEsecutore"
                                showSuggestion="true"
                                suggestionItems="{path: 'MCPaeseEsecutore>/I_Country'}"
                                data-model="MCPaeseEsecutore"
                                data-key="Country"
                                data-desc="Country_Text"
                            >
                                <suggestionItems>
                                    <core:Item
                                        key="{MCPaeseEsecutore>Country}"
                                        text="{MCPaeseEsecutore>Country_Text}"
                                    />
                                </suggestionItems>
                            </MultiInput>
                        </fb:control>
                    </fb:FilterGroupItem>
                    <fb:FilterGroupItem
                        name="Org. Commerciale"
                        label="Org. Commerciale"
                        groupName="General"
                        visibleInFilterBar="true"
                    >
                        <fb:control>
                            <Select
                                id="selectOrgCommerciale"
                                width="300px"
                                forceSelection="false"
                                items="{
                                path: 'MCOrgCommerciale>/C_SalesOrgVHTemp'}"
                            >
                                <core:Item
                                    key="{MCOrgCommerciale>SalesOrganization}"
                                    text="{MCOrgCommerciale>SalesOrganization}"
                                />
                            </Select>
                        </fb:control>
                    </fb:FilterGroupItem>
                    <fb:FilterGroupItem
                        name="Società"
                        label="Società"
                        groupName="General"
                        visibleInFilterBar="true"
                    >
                        <fb:control>
                            <Select
                                id="selectSocieta"
                                width="300px"
                                forceSelection="false"
                                items="{
                                path: 'MCSocieta>/ZR_EIM_COMPANY'}"
                            >
                                <core:Item
                                    key="{MCSocieta>CompanyCode}"
                                    text="{MCSocieta>CompanyCode}"
                                />
                            </Select>
                        </fb:control>
                    </fb:FilterGroupItem>

                    <fb:FilterGroupItem
                        name="Tipo Fattura SD"
                        label="Tipo Fattura SD"
                        groupName="General"
                        visibleInFilterBar="true"
                    >
                        <fb:control>
                            <MultiInput
                                id="multiInputTipoFatturaSD"
                                width="300px"
                                showValueHelp="true"
                                valueHelpRequest=".onValueHelpTipoFatturaSD"
                                showSuggestion="true"
                                suggestionItems="{path: 'MCTipoFatturaSD>/I_BillingDocumentTypeStdVH'}"
                                data-model="MCTipoFatturaSD"
                                data-key="BillingDocumentType"
                                data-desc="BillingDocumentType_Text"
                            >
                                <suggestionItems>
                                    <core:Item
                                        key="{MCTipoFatturaSD>BillingDocumentType}"
                                        text="{MCTipoFatturaSD>BillingDocumentType}"
                                    />
                                </suggestionItems>
                            </MultiInput>
                        </fb:control>
                    </fb:FilterGroupItem>
                </fb:filterGroupItems>
            </fb:FilterBar>
        </Panel>

        <Panel
            headerText="Elenco Fatture"
            width="100%"
        >
            <IconTabBar
                id="idIconTabBar"
                select=".onIconTabSelect"
                expandable="false"
                expanded="false"
            >
                <items>
                    <IconTabFilter
                        showAll="true"
                        count="{fattureModel>/Counts/All}"
                        text="Fatture"
                        key="All"
                    />
                    <IconTabSeparator />
                    <IconTabFilter
                        key="processed"
                        iconColor="Positive"
                        text="Processati"
                        icon="sap-icon://accept"
                        count="{fattureModel>/Counts/Processed}"
                    />
                    <IconTabFilter
                        key="working"
                        iconColor="Critical"
                        text="Da processare"
                        icon="sap-icon://pending"
                        count="{fattureModel>/Counts/Working}"
                    />
                    <IconTabFilter
                        key="error"
                        iconColor="Negative"
                        text="In errore"
                        icon="sap-icon://error"
                        count="{fattureModel>/Counts/Error}"
                    />
                </items>
            </IconTabBar>

            <Table
                id="idTableFatture"
                inset="false"
                mode="MultiSelect"
                items="{fattureModel>/Fatture}"
                selectionChange=".onSelectionChange"
            >
                <columns>
                    <Column width="3rem">
                        <Text text="Società" />
                    </Column>
                    <Column width="4rem">
                        <Text text="Cliente" />
                    </Column>
                    <Column width="5rem">
                        <Text text="Nominativo" />
                    </Column>
                    <Column width="6rem">
                        <Text text="P.IVA" />
                    </Column>
                    <Column width="6rem">
                        <Text text="C.F." />
                    </Column>
                    <Column width="6rem">
                        <Text text="Definizione" />
                    </Column>
                    <Column width="4rem">
                        <Text text="Doc Fatt" />
                    </Column>
                    <Column width="4rem">
                        <Text text="N° Doc" />
                    </Column>
                    <Column width="6rem">
                        <Text text="Data Registrazione" />
                    </Column>
                    <Column width="5rem">
                        <Text text="Esercizio" />
                    </Column>
                    <Column width="6rem">
                        <Text text="Tot Fattura" />
                    </Column>
                    <Column width="5rem">
                        <Text text="CD Univoco" />
                    </Column>
                    <Column width="4rem">
                        <Text text="PEC" />
                    </Column>
                    <Column width="6rem">
                        <Text text="Esito" />
                    </Column>
                    <Column width="7rem">
                        <Text text="Messaggio" />
                    </Column>
                    <Column width="8rem">
                        <Text text="Azioni" />
                    </Column>
                </columns>

                <items>
                    <ColumnListItem>
                        <cells>
                            <Text text="{fattureModel>Societa}" />
                            <Link
                                text="{fattureModel>Cliente}"
                                press=".onNavToCliente"
                            />
                            <Text text="{fattureModel>Nominativo}" />
                            <Text text="{fattureModel>PIVA}" />
                            <Text text="{fattureModel>CF}" />
                            <Text text="{fattureModel>Definizione}" />
                            <Text text="{fattureModel>DocFatt}" />
                            <Link
                                text="{fattureModel>NumeroDoc}"
                                press=".onNavToDocumento"
                            />
                            <Text text="{fattureModel>DataRegistrazione}" />
                            <Text text="{fattureModel>Esercizio}" />
                            <ObjectNumber
                                number="{fattureModel>TotFattura}"
                                unit="EUR"
                            />
                            <Text text="{fattureModel>CDUnivoco}" />
                            <Text text="{fattureModel>PEC}" />
                            <ObjectStatus
                                text="{fattureModel>LogText}"
                                icon="{fattureModel>LogIcon}"
                                state="{fattureModel>LogState}"
                            />
                            <Text text="{fattureModel>TipologiaErrore}" />
                            <HBox>
                                <Button
                                    icon="sap-icon://show"
                                    type="Transparent"
                                    press=".onViewXML"
                                />
                                <Button
                                    icon="sap-icon://attachment"
                                    type="Transparent"
                                    press=".onViewXML"
                                />
                                <Button
                                    text="Visualizza Fattura"
                                    type="Transparent"
                                    press=".onShowAdvancedPDFDialog"
                                />
                            </HBox>
                        </cells>
                    </ColumnListItem>
                </items>
            </Table>
        </Panel>

        <footer>
            <OverflowToolbar>
                <ToolbarSpacer />
                <Button
                    id="btnInviaIntermediario"
                    type="Accept"
                    enabled="false"
                    icon="sap-icon://paper-plane"
                    text="Invia al intermediario"
                    press=".onInvioData"
                />
            </OverflowToolbar>
        </footer>
    </Page>
</mvc:View>
